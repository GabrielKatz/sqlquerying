\documentclass[12pt,a4paper]{report}

\setlength{\topmargin}{0 cm}
\usepackage{lmodern}
\usepackage{times}
\usepackage{float}
\usepackage{rotating}
\usepackage[german]{babel}
\usepackage{graphics}
\graphicspath{ {../img/} }
\usepackage[table,dvipsnames]{xcolor}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{ntheorem}
\usepackage{pifont}
\theoremstyle{break}
\theorembodyfont{\normalfont}
\theoremprework{\bigskip\hrule\leavevmode\nopagebreak}
\theorempostwork{\nopagebreak\hrule\leavevmode}
\newtheorem{exercise}{Aufgabe}[chapter]
\theoremstyle{plain}
\theoremprework{\bigskip\hrule\leavevmode\nopagebreak}
\theorempostwork{\nopagebreak\hrule\leavevmode}
\newtheorem{proof}{Satz}[chapter]
\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}.}
\newcommand{\algostep}[2]{\noindent\parbox{4cm}{\scalebox{0.5}{\includegraphics{#1}}}
  \hfill
  \parbox{7cm}{#2}
  \vskip -5mm
}
\newcommand{\ucl}{\ding{56}}
\newcommand{\ign}{\rowcolor[gray]{0.5}}
\newcommand{\usd}[1]{{\cellcolor{SkyBlue}#1}}
\newcommand{\sel}[1]{{\cellcolor{LimeGreen}#1}}
\newcommand{\byp}[1]{{\cellcolor{LimeGreen!10}#1}}
\newcommand{\matrixstep}[2]{\noindent\parbox{6cm}{\scriptsize #1}
  \hfill
  \parbox{7cm}{\small #2}
  \vskip 2mm
}

\title{Relationale Datenabfragen mit SQL}
\author{Gabriel Katz}

\begin{document}
\maketitle
\tableofcontents
\chapter{Einleitung}

\section{Worum geht es hier?}
Eines der wichtigsten Zwecke von Computer ist die Speicherung von Daten. Wenn eine Menge von organisierten
Informationen dauerhaft auf einem zentralen Computer gespeichert werden, und diese Daten leicht abgefragt, 
erg\"{a}nzt, bearbeitet und gel\"{o}scht werden kann ist von einer \textbf{Datenbank} die Rede. Es gibt 
verschiedene Arten von Datenbanken. Die relationalen Datenbanken werden wir im n\"{a}chsten Abschnitt 
genauer betrachten. \textbf{Hierarchischen} Datenbanksystemen stammen noch von der Zeit vor den relationalen 
Datenbanken. Dort sind die Daten in Baumstruktur abgelegt. Zur Zeit gibt es einen starken Trend zu sogenennten 
\textbf{NoSQL}-Datenbanken. Dies sind nichtrelationale Datenbanken, bei welchen die St\"{a}rken in der Verteilung 
der Dateien und den Berechnungen auf verschiedene Rechner liegt. Es gibt verschiedene Arten, wie solche Daten 
abgelegt werden k\"{o}nnen: Dokumentenorientiert, objektorientiert und Key-Value-Datenbanken sind die 
verbreitetesten dieser Arten.
\section{Relationale Datenbanken}
Das Konzept f\"{u}r relationale Datenbanken basiert auf einem Paper von Dr. E. F. Codd aus dem Jahre 1970 
namens 'A Relational Model of Data for Large Shared Data Banks'. Dort schlug er vor, Daten in einer Menge von 
\textbf{Tabellen} darzustellen. Dies Tabellen haben einen Namen und mehrere \textbf{Spalten}. Eine Spalte einer 
Tabelle ist durch seinen Namen, seinen Datentyp, und ob sie obligatorisch oder fakultativ ist, definiert. Datentypen 
dr\"{u}cken aus, welche Art von Daten in der Spalte gespeichert werden kann. Beispielsweise hat eine Spalte, in 
welcher ein Datum gespeichert wir einen anderen Datentypen wie eine Spalte mit Zahl oder wie eine Spalte mit Text. 
Wir werden die Datentypen in SQL im n\"{a}chsten Kapitel etwas mehr im Detail betrachten. \\
Die Daten werden 
dann in den \textbf{Zeilen} der Tabelle gespeichert. Jede Zeile der Tabelle enth\"{a}lt mindestens in allen 
obligatorischen Spalten Daten. Normalerweise ist die Anzahl der Spalten der Tabelle (des Datenschemas) 
\"{u}berschaubar, wogegen die Anzahl der Zeilen riesig sein kann. \\
Eine Tabelle in einer relationalen Datenbank hat immer ein Merkmal, an welchem die Zeilen der Tabellen eindeutig
identifiziert werden können. Dieses Merkmal wird \textbf{Prim\"arschl\"ussel (PK)} genannt. Dieser Prim\"arschl\"ussel 
besteht h\"aufig aus einer einzelnen Tabellenspalte, doch er kann auch aus mehreren Tabellenspalten bestehen.
In diesem Fall spricht man von einem \textbf{zusammengesetzten} Schl\"ussel. H\"aufig ist der Prim\"arschl\"ussel eine
Spalte, welche nicht eigentliche Daten enth\"alt, sondern nur ein Kennzeichen.\\
Die Kernidee hinter den relationalen Datenbanken, ist, dass diese Tabellen verbunden sind. Doch wie sieht eine 
derartige Verbindung aus? Hier kommen die sogenannten \textbf{Fremdschl\"ussel (FK)} ins Spiel. Ein Fremdschl\"ussel
besteht aus einer oder mehreren Spalten einer Tabelle, welche den Prim\"arschl\"ussel einer anderen Tabelle 
referenzieren. Da zusammengesetzte Fremdschl\"ussel in der Praxis selten auftreten, werden wir diese in den Beispielen
nicht behandeln.\\
\begin{table}
    \begin{tabular}{|llll|}
    \hline
    CustomerId (PK) & FirstName & LastName & Email               \\ \hline
    1               & Hans      & Muster   & hmuster@example.com \\
    2               & Anja      & Tester   & atester@example.com \\
    3               & Ferdinand & Meier    & fmeier@example.com  \\ \hline
    \end{tabular}

    \caption{Customer}
    \label{tbl:firstExampleStart}
	\begin{tabular}{|lll|}
    \hline
    ServiceId (PK) & Name                      & Duration \\ \hline
    1              & Waschen, Schneiden        & 30:00    \\
    2              & Waschen, Schneiden, Fönen & 45:00    \\
    3              & T\"onen                     & 90:00    \\ \hline
    \end{tabular} 
    \caption{Service}
    \begin{tabular}{|llll|}
    \hline
    BookingId &ServiceFk  & CustomerFk  & StartDate        \\ 
       (PK) &(FK(Service.ServiceId)) & (FK(Customer.CustomerId)) &  \\ \hline
    1 &1                  & 3                   & 21.11.2014 10:30 \\
    2 &1                  & 1                   & 24.11.2014 08:30 \\
    3 & 3                  & 2                   & 23.11.2014 15:00 \\ \hline
    \end{tabular}
    \caption {Booking}
    \label{tbl:firstExampleEnd}
\end{table}

Tabellen~\ref{tbl:firstExampleStart} bis~\ref{tbl:firstExampleEnd} zeigen ein Beispiel f\"ur eine einfache Datenbank, wie 
sie in einem Buchungssystem eines Friseursalons vorstellbar ist. In der Tabelle $Customer$ sind die Kundeninformation 
aufgelistet. \"Andert sich beispielsweise die Emailadresse eines Kunden, muss diese lediglich an einer Stelle, n\"amlich 
in der entsprechenden Spalte der $Customer$-Tabelle angepasst werden. Wir sehen hier, dass der Prim\"arschl\"ussel, 
das Feld $CustomerId$, keine eigentlichen Information zum Benutzer enth\"alt. Doch wieso wurde dieses Feld 
eingef\"uhrt? Betrachten wir die Alternativen f\"ur den Prim\"arschl\"ussel: Wenn die Spalte $Email$ Prim\"arschl\"ussel
w\"are, entst\"anden zwei Nachteile. Einerseits k\"onnten die Kunden ihre Mailadresse nicht mehr wechseln, da sonst
das eindeutige Merkmal der Kundenzeile verloren gehen w\"urde. Andererseits k\"onnen keine zwei Benutzer die gleiche
Mailadresse teilen. Die Spalten $FirstName$ und $LastName$ sind nicht eindeutig, und k"onnen somit nicht als 
Prim\"arschl\"ussel (auch zusammengenommen nicht) gew\"ahlt werden. Es g\"abe noch die M"oglichkeit, die 
Kombination $FirstName$, $LastName$ und $Email$ als Prim\"arschl\"ussel zu w\"ahlen, doch zugunsten der 
Mutabilit\"at der Daten entscheidet man meistens gegen derart komplexe Prim\"arschl\"ussel und f\"uhrt lieber eine 
weitere Zeile ein.

Bei der Tabelle $Service$ verh\"alt es sich gleich wie bei der $Customer$-Tabelle: Da die anderen Spalten sich \"andern 
k\"onnen, und eventuell nicht eindeutig sind, wurde eine zus\"atzliche Spalte f\"ur den Prim\"rschl\"ussel eingef\"hrt,

Die $Booking$-Tabelle hat zwei Fremdschl\"ussel: Die Spalte $ServiceFk$ referenziert die Spalte $ServiceId$ der Tabelle 
$Service$, und die Spalte $CustomerFk$ referenziert die Spalte $CustomerId$ der Tabelle $Customer$. Der erste Eintrag
in der Booking-Tabelle bedeutet also, dass Ferdinand Meier (der Kunde mit der $CustomerId$ 3) am 21. November 2014
um 10:30 einen 45-minutigen Termin zum Haare waschen und schneiden hat (der Service mit der $ServiceId$ 1).

In diesem 
Beispiel enden Spalten, welche andere Tabellen referenzieren auf $-Fk$, und Prim\"arschl\"ussel auf $-Id$. Es handelt 
sich hierbei um eine Namenskonvention des Autoren. Andere Namen sind durchaus denkbar.
 
 \begin{exercise}\label{ex:changeFK}
Was bedeutet es, wenn beim Eintrag mit der $BookingId$ 2 der $ServiceFK$ von 1 auf 2 ge\"andert wird?
\end{exercise}
 \begin{exercise}\label{ex:noComposedKey}
Wieso k\"onnen die Spalten $ServiceId$ und $CustomerId$ keinen zusammengesetzten Prim\"arschl\"ussel f\"ur die 
Tabelle $Booking$ bilden?
\end{exercise}
 \begin{exercise}\label{ex:PkFk}
Darf eine Spalte zugleich Fremdschl\"ussel und Primarschl\"ussel sein? Falls nein, wieso nicht? Falls ja, gebe ein Beispiel.
\end{exercise}
 \begin{exercise}\label{ex:selfReference}
Darf ein Fremdschl\"ussel die eigene Tabelle referenzieren?
\end{exercise}
\newpage
\chapter{Relationale Datenbanken in SQL}
\section{Relationale Datenbanken}
\section{Datenbanken erstellen mit SQL}
\subsection{Datentypen}
\subsection{Modellierung}
\chapter{Datenbankabfragen}
\section{Aufbau einer SELECT-Abfragen}
\section{WHERE-Bedingungen}
\section{ORDER BY}
\section{verschiedene JOINs}

\chapter{Datenbankmanipulationen}
\section{Einf\"{u}gen}
\section{Updates}

\end{document}
